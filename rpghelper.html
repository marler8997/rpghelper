<!DOCTYPE html>
<html><head>
<title>rpghelper</title>
<style type="text/css">

* {margin:0;padding:0}
body {
    font-family: Impact, fantasy;
    margin: 20px;
    background:#222;
    color:#ddd;
}
table {
    border-collapse: collapse;
}
td {
    border: 1px solid #aaa;
    padding:5px 10px;

}

#MainCharacterDiv {
    /*font-size:200px;*/ /* some ridiculous value so we make sure characterstyle.css sets this */
}
.OpsTooltipPre {
    font-weight:normal;
}

</style>
<link rel="stylesheet" href="pathfinder2e/characterstyle.css">
<script src="pathfinder2e/common.js"></script>
<script src="pathfinder2e/analyze.js"></script>
<script src="pathfinder2e/render.js"></script>
<script>

    function get(id) { return document.getElementById(id); }

    function setLoadStatus(msg) {
        get('LoadFileErrorPre').innerText = '';
        get('LoadFileStatusPre').innerText = msg;
    }
    function setLoadError(msg) {
        get('LoadFileErrorPre').innerText = 'ERROR: ' + msg;
        get('LoadFileStatusPre').innerText = '';
    }
    function configFileSelect(evt) {
        var reader = new FileReader();
        reader.onerror = function errorHandler(evt) {
            switch(evt.target.error.code) {
            case evt.target.error.NOT_FOUND_ERR:
                setLoadError('File Not Found!');
                break;
            case evt.target.error.NOT_READABLE_ERR:
                setLoadError('File is not readable');
                break;
            case evt.target.error.ABORT_ERR:
                break; // noop
            default:
                setLoadError('An error occurred reading this file.');
            };
        };
        reader.onloadstart = function(e) {
            setLoadStatus('loading...');
        };
        reader.onload = function(e) {
            setLoadStatus('parsing config...');
            var data;
            try { data = JSON.parse(e.target.result); }
            catch (e) { setLoadError(e.message); throw e; }

            setLoadStatus('analyzing config...');
            var analyzeResult;
            try { analyzeResult = analyze.go(data); }
            catch (e) { setLoadError(e.message); throw e; }

            setLoadStatus('rendering...');
            var renderedHtml;
            try { renderedHtml = render.go(analyzeResult); }
            catch (e) { setLoadError(e.message); throw e; }
            get('MainCharacterDiv').innerHTML = renderedHtml;
            get('OpsPre').innerHTML = render.opsToTextBlock(data.ops);
            setLoadStatus('');
        }
        reader.readAsText(evt.target.files[0]);
    }
</script>
</head><body>
<input type="file" id="ConfigFileInput" name="file" />
<script>
    document.getElementById('ConfigFileInput').addEventListener('change', configFileSelect, false);
</script>
<pre id="LoadFileErrorPre" style="color:#a00"></pre>
<pre id="LoadFileStatusPre"></pre>
<div>
    <div id="MainCharacterDiv"></div>
</div>
<br/><br/>
<hr/>
<div>
    <h1>Ops</h1>
    <pre id="OpsPre"></pre>
</div>
</body></html>